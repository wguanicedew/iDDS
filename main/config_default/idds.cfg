# Licensed under the Apache License, Version 2.0 (the "License");
# You may not use this file except in compliance with the License.
# You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0
#
# Authors:
# - Wen Guan, <wen.guan@cern.ch>, 2019

[common]
#logdir = /var/log/idds
# loglevel = DEBUG
loglevel = INFO

[database]
default = sqlite:////tmp/idds.db
pool_size=20
pool_recycle=3600
echo=0
pool_reset_on_return=rollback

[rest]
host = https://localhost:443/idds
cacher_dir = /var/log/idds

[main]
# agents = clerk, transformer, carrier, conductor
agents = clerk, transformer, submitter, poller, receiver, trigger, finisher, conductor

[clerk]
num_threads = 4
poll_period = 1800
new_poll_period = 10
update_poll_period = 1800
new_command_poll_period = 10
update_command_poll_period = 600

poll_time_period = 60
poll_operation_time_period = 60
retrieve_bulk_size = 4
pending_time = 30

[transformer]
num_threads = 8
poll_period = 1800
new_poll_period = 60
update_poll_period = 1800

poll_time_period = 60
retrieve_bulk_size = 4
poll_operation_time_period = 240
message_bulk_size = 1000

# domapandawork.life_time = 86400
domapandawork.num_retries = 0

[carrier]
num_threads = 8
max_number_workers = 2
trigger_max_number_workers = 6
finisher_max_number_workers = 6

poll_period = 3600
new_poll_period = 10
update_poll_period = 300

poll_time_period = 60
poll_operation_time_period = 240
retrieve_bulk_size = 4
message_bulk_size = 1000

plugin.receiver = idds.agents.common.plugins.messaging.MessagingReceiver
plugin.receiver.brokers = atlas-mb.cern.ch
plugin.receiver.port = 61013
# plugin.notifier.vhost =
plugin.receiver.destination = /topic/doma.panda_idds
plugin.receiver.username = user
plugin.receiver.password = password
plugin.receiver.broker_timeout = 10

plugin.receiver.channels = {"default": {"brokers": ["atlas-mb.cern.ch:61013"],
                                        "destination": "/topic/doma.panda_idds",
                                        "username": "user",
                                        "password": "password",
                                        "broker_timeout": 360}}

# domapandawork.life_time = 86400
domapandawork.num_retries = 0
domapandawork.poll_panda_jobs_chunk_size = 10000

[conductor]
delay = 120
replay_times = 2

threshold_to_release_messages = 1000
random_delay = 60

plugin.notifier = idds.agents.conductor.plugins.messaging.MessagingSender
plugin.notifier.brokers = atlas-test-mb.cern.ch
plugin.notifier.port = 61013
plugin.notifier.destination = /queue/atlas.idds
plugin.notifier.username = user
plugin.notifier.password = password
plugin.notifier.broker_timeout = 10

plugin.notifier.channels = {"default": {"brokers": ["atlas-mb.cern.ch:61013"],
                                        "destination": "/topic/doma.idds",
                                        "username": "user",
                                        "password": "password",
                                        "broker_timeout": 360},
                            "ContentExt": {"brokers": ["atlas-test-mb.cern.ch:61013"],
                                            "destination": "/queue/atlas.idds",
                                            "username": "user",
                                            "password": "password",
                                            "broker_timeout": 360}
                           }
